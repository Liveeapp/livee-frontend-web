# ==========================================
# DEPLOYMENT INSTRUCTIONS
# ==========================================

# 1. Frontend Web App Deployment
# ------------------------------
# SSH into the server and go to the text directory
cd /var/www/liveeapp.io/html

# Pull the latest changes (including new docker-compose and proxy config)
git pull origin main

# Ensure the shared network exists
docker network create livee-network || true

# Stop and remove the old frontend container if running
docker-compose -f docker-compose.yaml down

# Build the frontend container (no-cache to ensure clean build)
docker-compose -f docker-compose.yaml build --no-cache

# Start the frontend container (detached)
# Note: This will NOT expose ports 80/443 anymore.
# It joins 'livee-network' and waits for the Backend Nginx to proxy valid requests.
docker-compose -f docker-compose.yaml up -d

# Check logs to ensure it started
docker logs livee-frontend-web

# 2. Update Backend Nginx Configuration
# -------------------------------------
# The frontend repo now contains a file 'backend-nginx.conf'.
# You need to copy this content to your Backend Nginx configuration.

# Go to your backend directory
cd /opt/livee-backend

# Backup existing config (if needed)
# cp nginx.ssl.conf nginx.ssl.conf.bak

# Copy the new config from the frontend integration
# Assuming you pulled the frontend repo in /var/www/liveeapp.io/html
cp /var/www/liveeapp.io/html/backend-nginx.conf ./nginx.ssl.conf

# Restart the Backend Nginx to apply changes
docker-compose restart nginx

# 3. Verification
# ---------------
# Access https://liveeapp.io/internal/admin/ -> Should show the React App
# Access https://liveeapp.io/auth/ -> Should hit the Auth Service
