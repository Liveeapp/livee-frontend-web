# ==========================================
# DEPLOYMENT INSTRUCTIONS: Frontend + Backend Integration
# ==========================================

# 1. Frontend Web App Deployment (Admin Dashboard)
# ------------------------------
# SSH into the server and go to the frontend directory
cd /var/www/liveeapp.io/html

# Pull the latest changes
git pull origin main

# Build and start the frontend container
# It will join the 'livee-backend_livee-network' automatically
docker-compose down
docker-compose build --no-cache
docker-compose up -d

# Check logs to ensure it's healthy
docker logs livee-frontend-web

# 2. Update Backend Nginx Configuration
# -------------------------------------
# IMPORTANT: The path MUST be /internal/admin/ to match the React app build.
# The frontend repo contains 'backend-nginx.conf' with the required settings.

# Go to your backend directory
cd /opt/livee-backend

# 1. Add the upstream (before the server blocks):
# upstream livee_frontend { server livee-frontend-web:3009; }

# 2. Add the location blocks (inside the HTTPS server block):
# location /internal/admin/ {
#     proxy_pass http://livee_frontend/internal/admin/;
#     proxy_http_version 1.1;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection 'upgrade';
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_cache_bypass $http_upgrade;
# }
#
# location /internal/admin {
#     return 301 /internal/admin/;
# }

# Restart the Backend Nginx to apply changes
docker-compose restart nginx

# 3. Verification
# ---------------
# Admin Dashboard (React): https://liveeapp.io/internal/admin/
# Backend Admin API:      https://liveeapp.io/admin/

# NOTE: The React frontend is now COMPLETELY SEPARATE from the /admin/ API path
# to prevent conflicts. It matches the base: "/internal/admin/" in vite.config.ts.
